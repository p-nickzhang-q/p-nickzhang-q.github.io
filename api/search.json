[{"id":"4e5438c9e012a77cb97e209dfb4eefbc","title":"Spring Boot å’Œ Android å®¢æˆ·ç«¯ SSE å®ç°è¯´æ˜","content":"Spring Boot å’Œ Android å®¢æˆ·ç«¯ SSE å®ç°è¯´æ˜æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäº Server-Sent Events (SSE) çš„æ¶ˆæ¯æ¨é€ç³»ç»Ÿï¼Œåç«¯ä½¿ç”¨ Spring Bootï¼Œå‰ç«¯ä½¿ç”¨ Android å®¢æˆ·ç«¯ã€‚ä»¥ä¸‹æ˜¯ç³»ç»Ÿçš„æ•´ä½“ç»“æ„å’Œå„ä¸ªéƒ¨åˆ†çš„è¯¦ç»†è¯´æ˜ã€‚\n1. Spring Boot åç«¯å®ç°åç«¯é€šè¿‡ SseEmitter æ¥å®ç° SSE åŠŸèƒ½ã€‚ä¸»è¦åŠŸèƒ½æ˜¯ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ª SseEmitter å®ä¾‹ï¼Œé€šè¿‡ SseEmitter è¿›è¡Œæ¶ˆæ¯æ¨é€ã€‚\næ ¸å¿ƒä»£ç è¯´æ˜1.1 è®¢é˜…æ¥å£12345678910private val clients = ConcurrentHashMap&lt;String, SseEmitter&gt;()fun subscribe(clientId: String): SseEmitter &#123;    val emitter = SseEmitter(60 * 60_000L) // 1å°æ—¶è¶…æ—¶    clients[clientId] = emitter    emitter.onCompletion &#123; &#125;    emitter.onTimeout &#123; clients.remove(clientId) &#125;    emitter.onError &#123; clients.remove(clientId) &#125;    return emitter&#125;\n\n\nclients æ˜¯ä¸€ä¸ª ConcurrentHashMapï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰åœ¨çº¿å®¢æˆ·ç«¯çš„ SseEmitter å®ä¾‹ï¼ŒclientId ä½œä¸ºå®¢æˆ·ç«¯çš„æ ‡è¯†ã€‚\nsubscribe æ–¹æ³•ä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„ SseEmitter å®ä¾‹ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 1 å°æ—¶ï¼Œå¹¶ä¸”åœ¨äº‹ä»¶è¶…æ—¶æˆ–é”™è¯¯æ—¶ç§»é™¤è¯¥å®¢æˆ·ç«¯ã€‚\n\n1.2 å‘é€æ¶ˆæ¯æ¥å£123456789101112131415161718192021222324const val RemoveClient = &quot;RemoveClient&quot;fun sendEvent(clientId: String, message: String): String &#123;    val emitter = clients[clientId]    return if (emitter != null) &#123;        try &#123;            when (message) &#123;                RemoveClient -&gt; &#123;                    clients.remove(clientId)                &#125;                else -&gt; &#123;                    emitter.send(SseEmitter.event().name(&quot;message&quot;).data(message))                &#125;            &#125;            &quot;Message sent&quot;        &#125; catch (e: IOException) &#123;            clients.remove(clientId)            &quot;Failed to send message&quot;        &#125;    &#125; else &#123;        &quot;Client not found&quot;    &#125;&#125;\n\n\nsendEvent æ–¹æ³•ç”¨äºå‘æŒ‡å®šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚\næ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹ï¼Œåç«¯ä¼šé‡‡å–ç›¸åº”çš„æ“ä½œï¼Œæ¯”å¦‚ç§»é™¤å®¢æˆ·ç«¯æˆ–æ¨é€æ¶ˆæ¯ã€‚\n\n2. Android å®¢æˆ·ç«¯å®ç°Android å®¢æˆ·ç«¯é€šè¿‡ RealEventSource æ¥æ¥æ”¶ SSE äº‹ä»¶ï¼Œå¹¶æ ¹æ®æ¶ˆæ¯å†…å®¹æ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚\næ ¸å¿ƒä»£ç è¯´æ˜2.1 å®¢æˆ·ç«¯è¿æ¥12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849enum class SSEMessage(val func: suspend () -&gt; Unit) &#123;    Logout(&#123;        mainVM.logout()    &#125;),    RemoveClient(&#123;        VehicleApi.service.sendEvent(mainVM.user.id!!, RemoveClient.name)    &#125;)&#125;fun connect() &#123;    val request: Request = Request.Builder()        .url(&quot;$&#123;baseUrl&#125;api/v1/em/vehicleauth/subscribe/$&#123;mainVM.user.id!!&#125;&quot;)        .header(STORAGE_AUTHORIZATION, SpUtils.token)        .build()    realEventSource = RealEventSource(request, object : EventSourceListener() &#123;        override fun onEvent(            eventSource: EventSource,            id: String?,            type: String?,            data: String,        ) &#123;            super.onEvent(eventSource, id, type, data)            try &#123;                SSEMessage.valueOf(data)            &#125; catch (e: Exception) &#123;                null            &#125;?.apply &#123;                activity.lifecycleScope.launch &#123;                    func()                &#125;            &#125;        &#125;        override fun onClosed(eventSource: EventSource) &#123;            super.onClosed(eventSource)        &#125;        override fun onFailure(eventSource: EventSource, t: Throwable?, response: Response?) \t\t &#123;            super.onFailure(eventSource, t, response)        &#125;        override fun onOpen(eventSource: EventSource, response: Response) &#123;            super.onOpen(eventSource, response)        &#125;    &#125;)    realEventSource.connect(client)&#125;\n\n\nconnect æ–¹æ³•ç”¨äºå»ºç«‹ä¸æœåŠ¡å™¨çš„ SSE è¿æ¥ã€‚\nRealEventSource æ˜¯ OkHttp çš„ä¸€ä¸ªæ‰©å±•ç±»ï¼Œèƒ½å¤Ÿå¤„ç† SSE åè®®ã€‚\nåœ¨æ¥æ”¶åˆ°äº‹ä»¶æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ ¹æ®äº‹ä»¶çš„ data å­—æ®µæ¥è§£ææ¶ˆæ¯ç±»å‹ï¼ˆå¦‚ Logoutã€RemoveClientï¼‰ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚\n\n2.2 äº‹ä»¶å¤„ç†12345678enum class SSEMessage(val func: suspend () -&gt; Unit) &#123;    Logout(&#123;        mainVM.logout()    &#125;),    RemoveClient(&#123;        VehicleApi.service.sendEvent(mainVM.user.id!!, RemoveClient.name)    &#125;)&#125;\n\n\nSSEMessage æšä¸¾ç±»å®šä¹‰äº†ä¸¤ç§æ¶ˆæ¯ç±»å‹ï¼š\nLogout: è§¦å‘ç”¨æˆ·ç™»å‡ºæ“ä½œã€‚\nRemoveClient: é€šçŸ¥æœåŠ¡å™¨ç§»é™¤å®¢æˆ·ç«¯ã€‚\n\n\næ¯ä¸ªæ¶ˆæ¯ç±»å‹å…³è”ä¸€ä¸ªæŒ‚èµ·å‡½æ•° (func)ï¼Œè¯¥å‡½æ•°ä¼šåœ¨æ¥æ”¶åˆ°äº‹ä»¶æ—¶æ‰§è¡Œã€‚\n\n3. ä½¿ç”¨è¯´æ˜3.1 åç«¯é…ç½®åœ¨ Spring Boot åç«¯ä¸­ï¼Œé€šè¿‡ SseEmitter å®ç°äº† SSE åŠŸèƒ½ã€‚å‰ç«¯åªéœ€è¦è°ƒç”¨ subscribe æ–¹æ³•æ¥è®¢é˜…ç‰¹å®šå®¢æˆ·ç«¯ï¼Œç„¶åä½¿ç”¨ sendEvent æ–¹æ³•å‘é€æ¶ˆæ¯ã€‚\n3.2 å®¢æˆ·ç«¯é…ç½®åœ¨ Android å®¢æˆ·ç«¯ä¸­ï¼Œé€šè¿‡ RealEventSource ç±»æ¥æ”¶æ¥è‡ªåç«¯çš„ SSE æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®æ¶ˆæ¯ç±»å‹æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼ˆå¦‚ç™»å‡ºæˆ–ç§»é™¤å®¢æˆ·ç«¯ï¼‰ã€‚å®¢æˆ·ç«¯è¿æ¥ä¼šåœ¨ connect æ–¹æ³•ä¸­å»ºç«‹ï¼Œæ¶ˆæ¯æ¥æ”¶åä¼šæ ¹æ® SSEMessage æšä¸¾ç±»å‹æ¥è§¦å‘ä¸åŒçš„æ“ä½œã€‚\n4. æ€»ç»“æœ¬å®ç°é€šè¿‡ SSE åè®®å®ç°äº†å®æ—¶æ¶ˆæ¯æ¨é€ï¼Œç»“åˆäº† Spring Boot åç«¯å’Œ Android å®¢æˆ·ç«¯ã€‚åç«¯ä½¿ç”¨ SseEmitter æ¥å¤„ç†ä¸å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè€Œå®¢æˆ·ç«¯ä½¿ç”¨ RealEventSource æ¥æ”¶å¹¶å¤„ç†äº‹ä»¶ã€‚é€šè¿‡æ­¤æ–¹å¼ï¼Œå‰åç«¯å®ç°äº†å®æ—¶é€šä¿¡ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤ŸåŠæ—¶å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚\nå…³é”®ç‚¹\nåç«¯ä½¿ç”¨ SseEmitter å®ç° SSE æ¶ˆæ¯æ¨é€ã€‚\nå®¢æˆ·ç«¯ä½¿ç”¨ RealEventSource æ¥æ”¶å®æ—¶äº‹ä»¶å¹¶å¤„ç†ã€‚\næ¶ˆæ¯ç±»å‹é€šè¿‡æšä¸¾ SSEMessage å®šä¹‰ï¼Œå¹¶ç»“åˆæŒ‚èµ·å‡½æ•°æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚\n\nè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªé«˜æ•ˆã€å®æ—¶çš„æ¶ˆæ¯æ¨é€ç³»ç»Ÿï¼Œé€‚ç”¨äºéœ€è¦å®æ—¶é€šçŸ¥å’Œæ›´æ–°çš„åœºæ™¯ã€‚\n","slug":"Spring-Boot-å’Œ-Android-å®¢æˆ·ç«¯-SSE-å®ç°è¯´æ˜","date":"2024-12-09T07:58:01.000Z","categories_index":"Spring Boot,SSE,Android","tags_index":"Spring Boot,SSE,Android","author_index":"zhangyida"},{"id":"41881a9e23e37779fa5f8aab973b895f","title":"æ–‡ä»¶æ ‡ç­¾ç®¡ç†å™¨","content":"\n    \n\nFILE-TAG-MANAGER-APP\n\n    â¯ REPLACE-ME\n\n\n    \n    \n    \n    \n\n\n\n\n    \n\n\n\nğŸ”— Table of Contents\nğŸ“ Overview\nğŸ‘¾ Features\nğŸ“ Project Structure\nğŸ“‚ Project Index\n\n\nğŸš€ Getting Started\nâ˜‘ï¸ Prerequisites\nâš™ï¸ Installation\nğŸ¤– Usage\nğŸ§ª Testing\n\n\nğŸ“Œ Project Roadmap\nğŸ”° Contributing\nğŸ— License\nğŸ™Œ Acknowledgments\n\n\nğŸ“ Overviewâ¯ REPLACE-ME\n\nğŸ‘¾ Featuresâ¯ REPLACE-ME\n\nğŸ“ Project Structure1234567891011121314â””â”€â”€ file-tag-manager-app/    â”œâ”€â”€ README.md    â”œâ”€â”€ build.gradle.kts    â”œâ”€â”€ gradle    â”‚   â””â”€â”€ wrapper    â”‚       â”œâ”€â”€ gradle-wrapper.jar    â”‚       â””â”€â”€ gradle-wrapper.properties    â”œâ”€â”€ gradle.properties    â”œâ”€â”€ gradlew    â”œâ”€â”€ gradlew.bat    â”œâ”€â”€ settings.gradle.kts    â””â”€â”€ src        â””â”€â”€ main            â””â”€â”€ kotlin\n\n\nğŸ“‚ Project Index\n    FILE-TAG-MANAGER-APP/\n     \n        __root__\n        \n            \n            \n                gradlew.bat\n                â¯ REPLACE-ME\n            \n            \n                build.gradle.kts\n                â¯ REPLACE-ME\n            \n            \n                settings.gradle.kts\n                â¯ REPLACE-ME\n            \n            \n        \n    \n     \n        src\n        \n            \n                main\n                \n                    \n                        kotlin\n                        \n                            \n                            \n                                Common.kt\n                                â¯ REPLACE-ME\n                            \n                            \n                                Db.kt\n                                â¯ REPLACE-ME\n                            \n                            \n                                TagManager.kt\n                                â¯ REPLACE-ME\n                            \n                            \n                                Context.kt\n                                â¯ REPLACE-ME\n                            \n                            \n                                FileTagMain.kt\n                                â¯ REPLACE-ME\n                            \n                            \n                        \n                    \n                \n            \n        \n    \n\n\n\nğŸš€ Getting Startedâ˜‘ï¸ PrerequisitesBefore getting started with file-tag-manager-app, ensure your runtime environment meets the following requirements:\n\nProgramming Language: Kotlin\nPackage Manager: Gradle\n\nâš™ï¸ InstallationInstall file-tag-manager-app using one of the following methods:\nBuild from source:\n\nClone the file-tag-manager-app repository:\n1â¯ git clone https://github.com/p-nickzhang-q/file-tag-manager-app\n\nNavigate to the project directory:\n1â¯ cd file-tag-manager-app\n\nInstall the project dependencies:\n\n\nUsing gradle  \n1â¯ gradle build\n\n\n\n\nğŸ¤– UsageRun file-tag-manager-app using the following command:Using gradle  \n1â¯ gradle run\n\n\nğŸ§ª TestingRun the test suite using the following command:Using gradle  \n1â¯ gradle test\n\n\n\nğŸ“Œ Project Roadmap\n Task 1: Implement feature one.\n Task 2: Implement feature two.\n Task 3: Implement feature three.\n\n\nğŸ”° Contributing\nğŸ’¬ Join the Discussions: Share your insights, provide feedback, or ask questions.\nğŸ› Report Issues: Submit bugs found or log feature requests for the file-tag-manager-app project.\nğŸ’¡ Submit Pull Requests: Review open PRs, and submit your own PRs.\n\n\nContributing Guidelines\n\n\nFork the Repository: Start by forking the project repository to your github account.\nClone Locally: Clone the forked repository to your local machine using a git client.1git clone https://github.com/p-nickzhang-q/file-tag-manager-app\nCreate a New Branch: Always work on a new branch, giving it a descriptive name.1git checkout -b new-feature-x\nMake Your Changes: Develop and test your changes locally.\nCommit Your Changes: Commit with a clear message describing your updates.1git commit -m &#x27;Implemented new feature x.&#x27;\nPush to github: Push the changes to your forked repository.1git push origin new-feature-x\nSubmit a Pull Request: Create a PR against the original project repository. Clearly describe the changes and their motivations.\nReview: Once your PR is reviewed and approved, it will be merged into the main branch. Congratulations on your contribution!\n\n\nContributor Graph\n\n\n   \n      \n   \n\n\n\n\nğŸ— LicenseThis project is protected under the SELECT-A-LICENSE License. For more details, refer to the LICENSE file.\n\nğŸ™Œ Acknowledgments\nList any resources, contributors, inspiration, etc. here.\n\n\n","slug":"æ–‡ä»¶æ ‡ç­¾ç®¡ç†å™¨","date":"2024-11-23T08:06:49.000Z","categories_index":"å·¥å…·","tags_index":"å·¥å…·","author_index":"zhangyida"},{"id":"b9663f58f18133b35bfe243f3e916a80","title":"Hello World","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post1$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server1$ hexo server\n\nMore info: Server\nGenerate static files1$ hexo generate\n\nMore info: Generating\nDeploy to remote sites1$ hexo deploy\n\nMore info: Deployment\n","slug":"hello-world","date":"2024-11-22T07:22:03.147Z","categories_index":"","tags_index":"","author_index":"zhangyida"}]